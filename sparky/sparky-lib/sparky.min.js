function isSafari(){return navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS")}var jb=jb||{};jb._letters={A:[[,1],[1,,1],[1,1,1],[1,,1],[1,,1]],B:[[1,1],[1,,1],[1,1],[1,,1],[1,1]],C:[[,1,1],[1],[1],[1],[,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1],[1,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[,,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,1],[1,,1],[1,1],[1,,1],[1,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,,1],[1,1,1],[1,1,1],[1,,1],[1,,1]],N:[[1,1],[1,,1],[1,,1],[1,,1],[1,,1]],O:[[,1,1],[1,,1],[1,,1],[1,,1],[1,1]],P:[[1,1],[1,,1],[1,1],[1],[1]],Q:[[0,1,1],[1,,1],[1,,1],[1,1,1],[,1,1]],R:[[1,1],[1,,1],[1,1],[1,,1],[1,,1]],S:[[,1,1],[1],[1,1,1],[,,1],[1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,1],[1,,1],[1,,1],[1,,1],[,1]],W:[[1,,1],[1,,1],[1,,1],[1,1,1],[1,1,1]],X:[[1,,1],[1,,1],[,1],[1,,1],[1,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1],[,,1],[,1],[1],[1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[1,1],[,1],[,1],[,1],[1,1,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],",":[[,,,],[,,,],[,,,],[,1,,],[1]],".":[[,,,],[,,,],[,,,],[,,,],[,1]],"!":[[1],[1],[1],[,],[1]],"?":[[1,1],[,,1],[,1],[,],[,1]],"(":[[,1],[1,,],[1,,],[1,,],[,1]],")":[[,1],[,,1],[,,1],[,,1],[,1]],"[":[[1,1],[1,,],[1,,],[1,,],[1,1]],"]":[[,1,1],[,,1],[,,1],[,,1],[,1,1]],"{":[[,1,1],[,1,,],[1,1],[,1,,],[,1,1]],"}":[[1,1],[,1],[,1,1],[,1],[1,1]],"'":[[1],[1],[,],[,],[,]],'"':[[1,,1],[1,,1],[,,],[,,],[,,]],"%":[[1,,1],[,,1],[,1],[1],[1,,1]],"&":[[1,1],[1,1],[1,1],[1,,1],[1,1,1]],"-":[[,,],[,,],[1,1,1],[,,],[,,]],"+":[[,],[,1],[1,1,1],[,1],[,]],"*":[[1,,1],[,1],[1,1,1],[,1],[1,,1]],"/":[[,,1],[,,1],[,1],[1,,],[1,,]],":":[[,,],[,1],[,,],[,1],[,,]],";":[[,,],[,1],[,,],[,1],[1,,]],_:[[,,],[,,],[,,],[,,],[1,1,1]]},jb._origPal=[[251,245,239],[242,211,171],[198,159,165],[139,109,156],[73,77,126],[39,39,68]],jb._rgbPal=[...jb._origPal],jb._screenSize=128,jb._transparent=[!1,!1,!1,!1,!1,!0],jb._dataSet=[0],jb.BTN_LEFT=0,jb.BTN_UP=1,jb.BTN_RIGHT=2,jb.BTN_DOWN=3,jb.BTN_A=4,jb.BTN_B=5,jb.BTN_START=6,jb.BTN_SELECT=7,jb._middleC=440*Math.pow(Math.pow(2,1/12),-9),jb._cam={x:0,y:0},jb._keys={left:{pressed:!1,justPressed:!1},up:{pressed:!1,justPressed:!1},right:{pressed:!1,justPressed:!1},down:{pressed:!1,justPressed:!1},a:{pressed:!1,justPressed:!1},b:{pressed:!1,justPressed:!1},start:{pressed:!1,justPressed:!1},select:{pressed:!1,justPressed:!1}},jb._drawColor=0,jb._screenBuffer=null,jb._gamepad=null,jb._getClearScreenData=function(e=5){const t=new Uint8ClampedArray(65536);for(let s=0;s<65536;s+=4){const[r,i,a]=this._rgbPal[e];t[s]=r,t[s+1]=i,t[s+2]=a,t[s+3]=255}return t},jb.init=function(e){window.AudioContext=window.AudioContext||window.webkitAudioContext;this._jbcanv=document.createElement("canvas"),this._jbcanv.width=1*this._screenSize,this._jbcanv.height=1*this._screenSize,this._jbctx=this._jbcanv.getContext("2d"),this._jbctx.scale(1,1),this._actx=new AudioContext,this._jbctx.imageSmoothingEnabled=!1,document.body.appendChild(this._jbcanv),this._draw=e&&e.draw?e.draw:function(){},this._update=e&&e.update?e.update:function(){};const t=document.createElement("style");t.textContent="\n    * {\n      padding: 0;\n      margin: 0;\n      box-sizing: border-box;\n    }\n    body {\n      background-color: #000;\n    }\n\n    canvas {\n      display: block;\n      margin: 0 auto;\n      image-rendering: pixelated;\n      image-rendering: crisp-edges;\n    }\n  ",document.head.appendChild(t),this._fitToScreen(),this._screenBuffer=new ImageData(new Uint8ClampedArray(65536),128,128),window.addEventListener("resize",()=>this._fitToScreen()),window.addEventListener("keydown",e=>this._onKeyPressed(e)),window.addEventListener("keyup",e=>this._onKeyReleased(e)),window.requestAnimationFrame(e=>this._step(e)),"function"==typeof e.init&&e.init()},jb._fitToScreen=function(){window.innerWidth>window.innerHeight?(this._jbcanv.style.height="100vh",this._jbcanv.style.width="auto"):(this._jbcanv.style.width="100vw",this._jbcanv.style.height="auto")},jb._step=function(e){this._lastFrame||(this._lastFrame=0);const t=e-this._lastFrame;this._frameRate=1e3/t,this._lastFrame=e,this._readGamepadState(),this._update(t/1e3),this._draw(),this._jbctx.putImageData(this._screenBuffer,0,0),window.requestAnimationFrame(e=>this._step(e))},jb._readGamepadState=function(){const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(!e||!e[0])return;const t=e[0],s=t.buttons[12].pressed||t.axes[1]<-.5,r=t.buttons[13].pressed||t.axes[1]>.5,i=t.buttons[14].pressed||t.axes[0]<-.5,a=t.buttons[15].pressed||t.axes[0]>.5,n=t.buttons[0].pressed,o=t.buttons[2].pressed,h=t.buttons[8].pressed,d=t.buttons[9].pressed;s&&(this._keys.up.pressed||(this._keys.up.justPressed=!0)),r&&(this._keys.down.pressed||(this._keys.down.justPressed=!0)),i&&(this._keys.left.pressed||(this._keys.left.justPressed=!0)),a&&(this._keys.right.pressed||(this._keys.right.justPressed=!0)),n&&(this._keys.a.pressed||(this._keys.a.justPressed=!0)),o&&(this._keys.b.pressed||(this._keys.b.justPressed=!0)),h&&(this._keys.select.pressed||(this._keys.select.justPressed=!0)),d&&(this._keys.start.pressed||(this._keys.start.justPressed=!0)),this._keys.up.pressed=s,this._keys.down.pressed=r,this._keys.left.pressed=i,this._keys.right.pressed=a,this._keys.a.pressed=n,this._keys.b.pressed=o,this._keys.select.pressed=h,this._keys.start.pressed=d},jb.cls=function(e){const t=this._getClearScreenData(e);for(let e=0;e<t.length;e++)this._screenBuffer.data[e]=t[e]},jb.camera=function(e=0,t=0){this._cam={x:e,y:t}},jb.spr=function(e,t,s,r=1,i=1,a=!1,n=!1){if(!(r<0||i<0))for(let o=0;o<i;o++)for(let h=0;h<r;h++){let d=7,u=7;i-o<=1&&(u=Math.round(7*(i-o))),r-h<=1&&(d=Math.round(7*(r-h))),this._spr(e+h+8*o,t+8*h,s+8*o,a,n,d,u)}},jb._spr=function(e,t,s,r=!1,i=!1,a=7,n=7){const o=this._data[this._dataSet].sprites.slice(64*e,64*(e+1)),{x:h,y:d}=this._adjustCoords(t,s);h>-8&&h<this._screenSize&&d>-8&&d<this._screenSize&&o.forEach((e,t)=>{let s=t%8,o=Math.floor(t/8);s>a||o>n||(r&&(s=7-s),i&&(o=7-o),this._transparent[e]||this._updatePixel(h+s,d+o,...this._rgbPal[e]))})},jb._updatePixel=function(e,t,s,r,i){if(this._isOnScreen(e,t)){const a=4*(128*t+e);a<this._screenBuffer.data.length-3&&(this._screenBuffer.data[a]=s,this._screenBuffer.data[a+1]=r,this._screenBuffer.data[a+2]=i,this._screenBuffer.data[a+3]=255)}},jb.color=function(e=0){e>=0&&e<this._rgbPal.length&&(this._drawColor=e)},jb.print=function(e,t,s,r=this._drawColor){const i=[],a="string"==typeof e?e.toUpperCase():e.toString().toUpperCase(),{x:n,y:o}=this._adjustCoords(t,s);for(let e=0;e<a.length;e++){const t=this._letters[a.charAt(e)];t&&i.push(t)}let h=0;i.forEach(e=>{let t=0,s=0;e.forEach(e=>{e.forEach((e,s)=>{e&&this._updatePixel(h+n+s,t+o,...this._rgbPal[r])}),s=Math.max(s,e.length),t+=1}),h+=1+s})},jb._circ=function(e,t,s,r=this._drawColor,i=!1){const{x:a,y:n}=this._adjustCoords(e,t);for(let e=-s;e<=s;e++)for(let t=-s;t<=s;t++){const o=t+a,h=e+n;if(i){if(t*t+e*e>=s*s)continue}else if(Math.abs(t*t+e*e-s*s)>s)continue;this._updatePixel(o,h,...this._rgbPal[r])}},jb.circ=function(e,t,s,r){jb._circ(e,t,s,r)},jb.circfill=function(e,t,s,r){jb._circ(e,t,s,r,!0)},jb.rect=function(e,t,s,r,i){this._rect(e,t,s,r,i,!1)},jb.rectfill=function(e,t,s,r,i){this._rect(e,t,s,r,i,!0)},jb._adjustCoords=function(e,t){return{x:Math.round(e-this._cam.x),y:Math.round(t-this._cam.y)}},jb._rect=function(e,t,s,r,i=this._drawColor,a=!1){e>s&&([e,s]=[s,e]),t>r&&([t,r]=[r,t]);const{x:n,y:o}=this._adjustCoords(e,t),{x:h,y:d}=this._adjustCoords(s,r),[u,c,_]=this._rgbPal[i];if(a)for(let e=o;e<=d;e++)for(let t=n;t<=h;t++)this._updatePixel(t,e,u,c,_);else{for(let e=o;e<=d;e++)this._updatePixel(n,e,u,c,_),this._updatePixel(h,e,u,c,_);for(let e=n;e<=h;e++)this._updatePixel(e,o,u,c,_),this._updatePixel(e,d,u,c,_)}},jb._isOnScreen=function(e,t){return e>=0&&e<this._screenSize&&t>=0&&t<this._screenSize},jb.map=function(e=0,t=0,s=0,r=0,i=127,a=127){for(let n=0;n<64;n++){const o=n%8,h=Math.floor(n/8);this._data[this._dataSet].map.slice(256*n,256*(n+1)).forEach((n,d)=>{const u=d%16,c=Math.floor(d/16);if(u+16*o<e||c+16*h<t||u+16*o>i-t||c+16*h>a-t)return;const _=s+128*o+8*u-8*e,l=r+128*h+8*c-8*t;_-this._cam.x<-8||_-this._cam.x>128||l-this._cam.y<-8||l-this._cam.y>128||this.spr(n,_,l)})}},jb.mget=function(e,t){if(e<0||t<0||e>128||t>128)return"";const s=Math.floor(e/16),r=Math.floor(t/16),i=Math.floor(e%16),a=8*r+s,n=16*Math.floor(t%16)+i,o=this._data[this._dataSet].map[256*a+n];return null!=o?o:""},jb.mset=function(e,t,s){if(e<0||t<0||e>128||t>128||s<0||s>63)return;const r=Math.floor(e/16),i=Math.floor(t/16),a=Math.floor(e%16),n=8*i+r,o=16*Math.floor(t%16)+a;this._data[this._dataSet].map[256*n+o]=s},jb.sget=function(e,t){if(e<0||t<0||e>63||t>63)return"";const s=Math.floor(e/8),r=Math.floor(t/8),i=Math.floor(e%8),a=8*r+s,n=8*Math.floor(t%8)+i,o=this._data[this._dataSet].sprites[64*a+n];return null!=o?o:""},jb.sset=function(e,t,s=this._drawColor){if(e<0||t<0||e>63||t>63||s<0||s>5)return;const r=Math.floor(e/8),i=Math.floor(t/8),a=Math.floor(e%8),n=8*i+r,o=8*Math.floor(t%8)+a;this._data[this._dataSet].sprites[64*n+o]=s},jb.fget=function(e,t){return e<0||e>63||null!=t&&t<0||null!=t&&t>7?null:null==t?this._data[this._dataSet].spriteFlags[e]:!!(this._data[this._dataSet].spriteFlags[e]&1<<t)},jb.fset=function(e,t,s){if(!(e<0||e>63||null!=s&&(t<0||t>7)||null==s&&(t<0||t>255)))if(null==s)this._data[this._dataSet].spriteFlags[e]=t;else{const r=1<<t;s?this._data[this._dataSet].spriteFlags[e]|=r:this._data[this._dataSet].spriteFlags[e]&=~r}},jb.pget=function(e,t){if(this._isOnScreen(e,t)){const s=4*(128*t+e),[r,i,a]=this._screenBuffer.data.slice(s,s+4);return this._rgbPal.findIndex(e=>e[0]===r&&e[1]===i&&e[2]===a)}return""},jb.pset=function(e,t,s=this._drawColor){s>=0&&s<=5&&this._updatePixel(e,t,...this._rgbPal[s])},jb._resetKeys=function(){for(key in this._keys)this._keys[key].justPressed=!1},jb._onKeyPressed=function(e){switch(this._actx.resume(),e.key.toLowerCase()){case"arrowup":this._keys.up.pressed=!0,this._keys.up.justPressed=!0;break;case"arrowdown":this._keys.down.pressed=!0,this._keys.down.justPressed=!0;break;case"arrowleft":this._keys.left.pressed=!0,this._keys.left.justPressed=!0;break;case"arrowright":this._keys.right.pressed=!0,this._keys.right.justPressed=!0;break;case"z":case"c":this._keys.a.pressed=!0,this._keys.a.justPressed=!0;break;case"x":this._keys.b.pressed=!0,this._keys.b.justPressed=!0;break;case"escape":this._keys.start.pressed=!0,this._keys.start.justPressed=!0;break;case"tab":this._keys.select.pressed=!0,this._keys.select.justPressed=!0}},jb._onKeyReleased=function(e){switch(e.key){case"ArrowUp":this._keys.up.pressed=!1;break;case"ArrowDown":this._keys.down.pressed=!1;break;case"ArrowLeft":this._keys.left.pressed=!1;break;case"ArrowRight":this._keys.right.pressed=!1;break;case"z":case"c":this._keys.a.pressed=!1;break;case"x":this._keys.b.pressed=!1;break;case"Escape":this._keys.start.pressed=!1;break;case"Tab":this._keys.select.pressed=!1}},jb.btn=function(e){switch(e){case 0:return this._keys.left.pressed;case 1:return this._keys.up.pressed;case 2:return this._keys.right.pressed;case 3:return this._keys.down.pressed;case 4:return this._keys.a.pressed;case 5:return this._keys.b.pressed;case 6:return this._keys.start.pressed;case 7:return this._keys.select.pressed}},jb.btnp=function(e){switch(e){case 0:return!!this._keys.left.justPressed&&(this._keys.left.justPressed=!1,!0);case 1:return!!this._keys.up.justPressed&&(this._keys.up.justPressed=!1,!0);case 2:return!!this._keys.right.justPressed&&(this._keys.right.justPressed=!1,!0);case 3:return!!this._keys.down.justPressed&&(this._keys.down.justPressed=!1,!0);case 4:return!!this._keys.a.justPressed&&(this._keys.a.justPressed=!1,!0);case 5:return!!this._keys.b.justPressed&&(this._keys.b.justPressed=!1,!0);case 6:return!!this._keys.start.justPressed&&(this._keys.start.justPressed=!1,!0);case 7:return!!this._keys.select.justPressed&&(this._keys.select.justPressed=!1,!0)}},jb._getFrequency=function(e,t=0){return freq=this._middleC*Math.pow(Math.pow(2,1/12),e),freq*Math.pow(2,t)},jb._soundEffect=function(e,t,s,r,i,a,n,o){void 0===t&&(t=200),void 0===s&&(s="sine"),void 0===r&&(r=1),void 0===i&&(i=0),void 0===a&&(a=2);const h=a/4,d=a,u=e.createOscillator(),c=e.createGain();switch(u.connect(c),c.connect(e.destination),u.type=s,u.frequency.value=t,c.gain.value=r,isSafari()||function(t){"fade-in"!==n&&(t.gain.value=0,t.gain.linearRampToValueAtTime(0,e.currentTime+i),t.gain.linearRampToValueAtTime(r,e.currentTime+i+.01));"fade-out"!==n&&(t.gain.linearRampToValueAtTime(r,e.currentTime+i+a-.01),t.gain.linearRampToValueAtTime(0,e.currentTime+i+a-.001))}(c),n){case"fade-in":(_=c).gain.value=0,_.gain.linearRampToValueAtTime(0,e.currentTime+i),_.gain.linearRampToValueAtTime(r,e.currentTime+i+h);break;case"fade-out":!function(t){t.gain.linearRampToValueAtTime(r,e.currentTime+i),t.gain.linearRampToValueAtTime(0,e.currentTime+i+d)}(c);break;case"vibrato":!function(s){const r=[];for(let e=0;e<a;e+=.01)r.push(t+Math.sin(40*e)*(t/40));s.setValueCurveAtTime(new Float32Array(r),e.currentTime+i,a)}(u.frequency);break;case"slide":!function(s){if(!o)return;const r=[t,o];s.setValueCurveAtTime(new Float32Array(r),e.currentTime+i,a)}(u.frequency)}var _,l;(l=u).start(e.currentTime+i),l.stop(e.currentTime+i+a)},jb.sfx=function(e){const t=this._data[this._dataSet].sfx[e],s=t.tempo/64;for(let e=0;e<t.samples.length;e++){const r=t.samples[e];let i=1;if(!["fade-in","fade-out"].includes(r.fx))for(let s=e+1;s<t.samples.length;s++){const e=t.samples[s];if(!e||e.dist!==r.dist||e.type!==r.type||e.volume!==r.volume||e.fx!==r.fx)break;i++}this._soundEffect(this._actx,this._getFrequency(r.dist,r.oct),r.type,r.volume/40,s*e,s*i,r.fx,t.samples[e+1]?this._getFrequency(t.samples[e+1].dist,t.samples[e+1].oct):null),e+=i-1}},jb._createImageData=function(){this._images=[];for(let e=0;e<64;e++){const t=this._data[this._dataSet].sprites.slice(64*e,64*(e+1)).map(e=>{const t=this._transparent[e]?0:255;return[...this._rgbPal[e],t]}).flat(),s=new ImageData(new Uint8ClampedArray(t),8,8);this._images.push(s)}},jb.palt=function(e,t){null!=e||null!=t?e>=0&&e<this._origPal.length&&(this._transparent[e]=t):this._transparent=[!1,!1,!1,!1,!1,!0]},jb.pal=function(e,t){null!=t?this._rgbPal[e]=this._origPal[t]:null==e&&(this._rgbPal=[...this._origPal],this._transparent=[!1,!1,!1,!1,!1,!0])},jb.__switchDataset=function(e){e>0&&e<this._data.length&&(this._dataSet=e)},jb.line=function(e,t,s,r,i=this._drawColor){let{x:a,y:n}=this._adjustCoords(e,t),{x:o,y:h}=this._adjustCoords(s,r);const d=Math.abs(o-a),u=Math.abs(h-n),c=a<o?1:-1,_=n<h?1:-1;let l=d-u;for(;this._updatePixel(a,n,...this._rgbPal[i]),a!==o||n!==h;){const e=2*l;e>-u&&(l-=u,a+=c),e<d&&(l+=d,n+=_)}};